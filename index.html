<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Presencial</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: linear-gradient(135deg, #2563eb, #1e40af);
      min-height: 100vh;
      color: #111;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
    }
    h1 {
      margin-top: 0;
      color: #2563eb;
    }
    ul {
      padding-left: 20px;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // ================= SUPABASE =================
    const SUPABASE_URL = "https://azbebkpnsldielczthfp.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6YmVia3Buc2xkaWVsY3p0ZmhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3MzIyMzUsImV4cCI6MjA4MTMwODIzNX0.KzOu_5f6w7aZPZCHE-6uD1m-vpxQnP9t9pBUb_1XGoo";

    const supabase = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );

    // ================= APP =================
    const App = () => {
      const [workers, setWorkers] = useState([]);
      const [clockings, setClockings] = useState([]);
      const [error, setError] = useState(null);

      useEffect(() => {
        const loadDataFromSupabase = async () => {
          try {
            // Trabajadores
            const workersResult = await supabase
              .from("trabajadores")
              .select("*");

            if (workersResult.data) {
              setWorkers(workersResult.data);
            }

            // Fichajes
            const clockingsResult = await supabase
              .from("clockings")
              .select("*");

            if (clockingsResult.data) {
              setClockings(clockingsResult.data);
            }
          } catch (err) {
            console.error(err);
            setError("Error cargando datos desde Supabase");
          }
        };

        loadDataFromSupabase();
      }, []);

      return (
        <div className="container">
          <h1>Sistema de Control de Presencia</h1>

          {error && <p style={{ color: "red" }}>{error}</p>}

          <h2>Trabajadores</h2>
          <ul>
            {workers.map(w => (
              <li key={w.id}>{w.nombre}</li>
            ))}
          </ul>

          <h2>Fichajes</h2>
          <ul>
            {clockings.map(c => (
              <li key={c.id}>{c.created_at}</li>
            ))}
          </ul>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
